{
  "hash": "dc8cbd35a8368388c6b6582003cf1d04",
  "result": {
    "markdown": "---\n# title-block-banner: img/pexels-lukas-590045.jpg\ntitle: \"Introduction à RMarkdown\"\nsubtitle: \"Utiliser RMarkdown pour rédiger des rapports\"\nauthor:\n  - John Godlee\n  - Jonathan Kitt (adaptation)\ndate: \"2022-10-24\"\ncategories: [R, RStudio, Tidyverse]\nformat: \n  html: \n    toc: true\n    toc-depth: 2\n    toc-title: \"Sommaire\"\n---\n\n\n*Ce tutoriel est adapté de [Getting started with R Markdown](https://ourcodingclub.github.io/tutorials/rmarkdown/) du site [Our Coding Club](https://ourcodingclub.github.io/).*\n\n<br>\n\n# Introduction\n\n## Qu'est-ce que R Markdown ?\n\nR Markdown vous permet de créer des documents, notamment des rapports de vos analyses. Les personnes qui liront votre code doivent pouvoir facilement comprendre et reproduire votre analyse : c'est la reproductibilité.\n\nVous pouvez créer un document R Markdown et le partager, ou vous en servir à titre personnel pour garder une trace des étapes et des résultats d'une analyse.\n\nR Markdown permet d'afficher le code utilisé et les résultats obtenus (graphiques, tables, ...) ainsi que des commentaires explicatifs, un peu à la manière d'un cahier de laboratoire.\n\nR Markdown utilise la syntaxe Markdown, un langage *markup* qui propose des outils pour créer des documents avec des en-têtes, des images, des liens, ...\n\nUn document Markdown peut être converti en différents formats comme du *html* ou du *pdf*.\n\nLorsque vous créez un fichier R Markdown (`.Rmd`), vous utiliserez la syntaxe Markdown aux côtés de blocs de code écrits en R (ou d'autres langages de programmation). Ce fichier est ensuite compilé : le format Markdown et le code sont évalués, et un fichier de sortie (`html`, `pdf`, ...) est généré.\n\n![](img/horst_rmd.png){width=\"50%\"}\n\n<br>\n\n## Pré-requis\n\nSi vous n'avez pas suivi les autres tutoriels, vous pouvez [créer un projet RStudio](https://ateliers-codons.netlify.app/posts/02-premiers-pas-avec-r/#créer-un-projet) et [une arborescence](https://ateliers-codons.netlify.app/posts/02-premiers-pas-avec-r/#créer-une-arborescence).\n\nPour utiliser RMarkdown dans RStudio, installez et chargez le package `rmarkdown` :\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"rmarkdown\")\nlibrary(rmarkdown)\n```\n:::\n\n\n# Créer un document R Markdown\n\n## Ouvrir un nouveau fichier R Markdown\n\nPour créer un nouveau document R Markdown (.RMd), cliquez sur *File \\> New File \\> R Markdown ...*. Vous pouvez également cliquer sur le symbole *Plus* et choisir *R Markdown...*.\n\n![](img/rmd_01.png){width=\"75%\"}\n\nDans la fenêtre qui s'ouvre, laissez les paramètres par défaut et cliquez sur *Create Empty Document* (en cliquant sur *OK* vous créerez un document pré-rempli).\n\nVotre document vide s'ouvre dans la fenêtre en haut à gauche de RStudio.\n\n::: {layout-ncol=\"2\"}\n![](img/rmd_02.png)\n\n![](img/rmd_03.png)\n:::\n\n<br>\n\n## Ajouter un en-tête\n\nUn document Rmd débute par une section d'en-tête encadrée par trois tirets et qui contient généralement les éléments suivants :\n\n-   un titre\n\n-   les auteurs\n\n-   la date\n\n-   le format de sortie\n\nVoici un exemple d'en-tête à insérer en haut de votre ficher .Rmd :\n\n\n::: {.cell}\n\n```{.r .cell-code}\n---\ntitle: \"Pingouins de l'archipel Palmer\"\nauthor: Jonathan Kitt\ndate: 2022-11-14\noutput: html_document\n---\n```\n:::\n\n\n::: {.callout-note icon=\"true\"}\n## Le YAML\n\nCet en-tête s'appelle un **YAML : Yet Another Markup Language**\n:::\n\n<br>\n\nSauvegardez votre fichier Rmd en cliquant sur l'icône disquette (ou en utilisant la combinaison Ctrl + S). Choisissez un nom pour votre fichier et placez-le dans votre dossier *docs*.\n\n::: {layout-ncol=\"2\"}\n![](img/rmd_04.png)\n\n![](img/rmd_05.png)\n:::\n\n<br>\n\n## Compiler un document R Markdown\n\nPour compiler votre fichier Rmd et générer le document au format choisi (`html` dans notre cas), cliquez sur le bouton *Knit* : le document s'ouvre dans une nouvelle fenêtre.\n\n![](img/rmd_06.png){width=\"100%\"}\n\n<br>\n\n::: {.callout-tip icon=\"true\"}\n## Raccourci clavier : compiler un fichier Rmd\n\nPour compiler un fichier Rmd, utilisez la combinaison **Ctrl + Shift + K**\n:::\n\n<br>\n\nDans l'explorateur de fichiers vous pouvez remarquer qu'un fichier **mesures_pingouins.html** a été ajouté dans le répertoire **docs** : il s'agit du fichier `html` issu de la compilation du fichier Rmd. En cliquant sur le nom de ce fichier vous aurez le choix entre l'ouvrir dans l'éditeur ou dans un navigateur internet.\n\n![](img/rmd_07.png){width=\"100%\"}\n\n<br>\n\n::: {.callout-tip icon=\"true\"}\n## Prévisualiser le document\n\nPar défaut, lorsque vous compilez un fichier Rmd, le document généré s'ouvre dans une nouvelle fenêtre. Vous pouvez choisir d'afficher cette pré-visualisation directement dans l'onglet *Viewer* en bas à droite de RStudio en cliquant sur la roue à droite du bouton Knit puis sur *Preview in Viewer Pane*.\n\nEn décochant *Show Previews Inline*, le résultat de l'exécution de code ne s'affichera plus dans votre fichier `Rmd`.\n\n![](img/rmd_08.png){width=\"100%\"}\n:::\n\n<br>\n\n\n::: {.cell}\n\n:::\n\n\n# Les bases de R Markdown\n\nPour mettre en forme votre texte, vous allez utiliser la syntaxe markdown.\n\n::: {.callout-note icon=\"true\"}\n## Editeur visuel\n\nVous pouvez modifier votre fichier Rmd à la manière d'un éditeur de texte à l'aide de l'éditeur visuel : cliquez sur le bouton **Visual** en haut du fichier.\n\n![](img/rmd_10.png){width=\"100%\"}\n:::\n\n<br>\n\n## Mettre en forme le texte\n\nPour mettre en forme votre texte, utilisez les conventions suivantes :\n\n|                               |                         |\n|-------------------------------|-------------------------|\n| \\*italiques\\*                 | *italiques*             |\n| \\*\\*gras\\*\\*                  | **gras**                |\n| \\*\\*\\*italiques et gras\\*\\*\\* | ***italiques et gras*** |\n| \\~\\~barré\\~\\~                 | ~~barré~~               |\n| \\[texte\\](lien)               | [texte](lien)           |\n| texte \\^exposant\\^            | texte ^exposant^        |\n| texte \\~indice \\~             | texte ~indice~          |\n| \\`code\\`                      | `code`                  |\n\n<br>\n\n## Insérer des titres\n\nPour insérer un titre, utilisez un `#`. Les différents niveaux (titre, sous-titre, paragraphe, ...) se définissent en fonction du nombre de `#` :\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Titre\n## Sous-titre\n### Paragraphe\n```\n:::\n\n\n<br>\n\n## Insérer une ligne horizontale\n\nPour insérer une ligne horizontale dans votre texte, utilisez *trois étoiles* `***`.\n\n<br>\n\n## Insérer des listes\n\nVous pouvez insérer une liste à puces :\n\n\n::: {.cell}\n\n```{.r .cell-code}\n* item a  \n* item b  \n* item c  \n    + item c1\n    + item c2\n```\n:::\n\n\n-   item a\\\n-   item b\\\n-   item c\n    -   item c1\n    -   item c2\n\n<br>\n\nOu une liste numérotée :\n\n\n::: {.cell}\n\n```{.r .cell-code}\n1. item a  \n2. item b  \n3. item c  \n```\n:::\n\n\n1.  item a\\\n2.  item b\\\n3.  item c\n\n<br>\n\n## Insérer un tableau\n\nVous pouvez insérer un tableau en le \"dessinant\" :\n\n-   des tirets `-` pour déparer l'en-tête du reste du tableau\n\n-   des barres verticales `|` pour délimiter les colonnes\n\n\n::: {.cell}\n\n```{.r .cell-code}\n| col1 | col2 | col3 |\n| ---- | ---- | ---- |\n| A    | 1    | ech1 |\n| B    | 2    | ech2 |\n| C    | 3    | ech3 |  \n```\n:::\n\n\n| col1 | col2 | col3 |\n|------|------|------|\n| A    | 1    | ech1 |\n| B    | 2    | ech2 |\n| C    | 3    | ech3 |\n\n<br>\n\nPour aligner le texte, utilisez deux points `:` :\n\n\n::: {.cell}\n\n```{.r .cell-code}\n| gauche | centre | droite |\n| :----- | :----: | -----: |\n| A      | 1      | ech1   |\n| B      | 2      | ech2   |\n| C      | 3      | ech3   |  \n```\n:::\n\n\n| gauche | centre | droite |\n|:-------|:------:|-------:|\n| A      |   1    |   ech1 |\n| B      |   2    |   ech2 |\n| C      |   3    |   ech3 |\n\n<br>\n\n## Equations\n\nLa syntaxe pour insérer une équation se base sur [LaTeX](https://rpruim.github.io/s341/S19/from-class/MathinRmd.html) :\n\n\n::: {.cell}\n\n```{.r .cell-code}\nUn cercle de rayon $r$ a une aire $A = \\pi \\times r^{2}$ \n```\n:::\n\n\nUn cercle de rayon $r$ a une aire $A = \\pi \\times r^{2}$\n\n<br>\n\n## Insérer une image\n\nVous pouvez insérer une image dans votre fichier :\n\n::: {.callout-important icon=\"true\"}\n## Chemins vers les fichiers\n\nLorsque que vous indiquez un chemin vers un fichier dans RMarkdown, le dossier \"racine\" n'est plus votre répertoire de travail (votre projet) mais le dossier dans lequel se trouve le fichier .Rmd, dans le cas présent le répertoire *docs/*.\n\nIl faut donc revenir en arrière d'un niveau, à l'aide de **`../`**.\n\nLorsque vous naviguez dans une arborescence à l'aide de la ligne de commande, **`.`** indique le répertoire de travail et **`..`** le répertoire situé un niveau au-dessus dans votre arborescence.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n![pingouins](../figs/pingouins.png){width=\"75%\"}\n```\n:::\n\n\n![](img/rmd_18.png){width=\"75%\"}\n\nL'option `width` permet d'ajuster la largeur relative de l'image.\n\n<br>\n\n# Rédiger un document de façon dynamique\n\nLorsque vous rédigez un rapport, vous pouvez le faire *\"en dur\"*, c'est-à-dire inscrire directement dans le texte toutes les valeurs numériques, les résultats de calculs, insérer des graphiques générés séparément, ...\n\nCette façon de procéder présente un désavantage majeur : votre document ne sera valable qu'une seule fois pour une seule analyse (vous pourrez toujours le ré-utiliser en remplaçant les valeurs numériques). De plus, le risque d'erreur est non négligeable : coller des valeurs numériques copiées depuis un autre logiciel peut créer des mauvaises surprises.\n\nR Markdown vous permet de rédiger votre fichier de façon *\"dynamique\"*. Vous pouvez ainsi importer les fichiers nécessaires à votre analyse, effectuer des calculs et générer des graphiques à l'aide de code R qui sera compilé.\n\nVotre fichier `Rmd` pourra ainsi être modifié et ré-utilisé pour des analyses similaires sur d'autres jeux de données.\n\n<br>\n\n## Insérer un bloc de code R\n\nCommençons par importer notre jeu de données. Nous allons pour cela insérer un *bloc de code* dans notre fichier.\n\nPour insérer un bloc de code, cliquez sur l'icône située en haut à droite du fichier `Rmd`et choisissez `R` (d'autres langages de programmation sont disponibles).\n\n![](img/rmd_56.png){width=\"100%\"}\n\nUn bloc de code contient les éléments suivants :\n\n-   des *accents* *\\`\\`\\`* pour délimiter le bloc\n\n-   des accolades contenant des informations : `{r}` (nous verrons d'autres paramètres plus loin)\n\n-   trois icônes :\n\n    -   une *roue* pour ajouter des options\n\n    -   une flèche pointant vers le bas pour exécuter tout le code jusqu'à ce bloc\n\n    -   une flèche pointant vers la droite pour exécuter le bloc (vous pouvez également exécuter le code d'un bloc en vous positionnant sur le code et en utilisant la combinaison *Ctrl* + *Entrée*)\n\n<br>\n\n::: {.callout-tip icon=\"true\"}\n## Raccourci clavier : insérer un bloc de code\n\nPour insérer un bloc de code, utiliser la combinaison **Ctrl + Alt + I**\n:::\n\n<br>\n\nAjoutez le code suivant dans ce bloc de code et exécutez-le (attention au chemin !) :\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npingouins <- read.csv(\"../data/pingouins_propre.csv\")\n```\n:::\n\n\nLe fichier a bien été importé et stocké dans l'objet **pingouins** visible dans l'environnement.\n\nLorsque vous compilez votre fichier Rmd, le code est exécuté et s'affiche dans votre document de sortie (au format `html`). L'objet `pingouins` n'est pas visible dans l'environnement lorsque vous compilez votre fichier Rmd, mais il est bel et bien disponible et vous pourrez le manipuler à l'aide de blocs de code.\n\n<br>\n\n## Paramétrer un bloc de code\n\nLorsque vous insérez un bloc de code, des paramètres vous permettent de préciser si le code doit être affiché ou non, exécuté ou non, ...\n\nVous pouvez régler certains paramètres en cliquant sur la *roue* à droite du bloc :\n\n![](img/rmd_57.png){width=\"100%\"}\n\nVous pouvez également renseigner ces paramètres directement dans les accolades : `{r, eval = FALSE}` par exemple.\n\n| option  | par défaut | effet                                  |\n|---------|------------|----------------------------------------|\n| eval    | TRUE       | évaluer le code et inclure le résultat |\n| echo    | TRUE       | afficher le code avec le résultat      |\n| warning | TRUE       | afficher les messages d'avertissement  |\n| error   | FALSE      | afficher les messages d'erreur         |\n\n<br>\n\nSi vous le souhaitez, vous pouvez définir en haut de votre fichier `Rmd` les paramètres à appliquer à l'ensemble des blocs de code :\n\n![](img/rmd_58.png){width=\"100%\"}\n\n::: {.callout-caution icon=\"true\"}\n## Bonnes pratiques : nommer les blocs de code\n\nComme vous pouvez le voir dans le dernier exemple, il est utile de nommer les blocs de code :\n\n-   en utilisant la roue à droite du bloc et en tapant le nom dans *Chunck Name*\n\n-   en tapant le nom directement dans les accolades\n:::\n\n## Exécuter du code dans le texte\n\nNous avons vu plus haut comment insérer du texte au format code.\n\nVous pouvez exécuter le code en ajoutant un `r` :\n\n\n::: {.cell}\n\n```{.r .cell-code}\nLa racine carrée de 20 est **`r sqrt(20)`**\n```\n:::\n\n\nLa racine carrée de 20 est **4.472136**\n\n<br>\n\n# Transformer un script en .Rmd\n\nDans le tutoriel [Premiers pas avec R](https://ateliers-codons.netlify.app/posts/02-premiers-pas-avec-r/) nous avons vu comment nettoyer, manipuler et représenter des données.\n\nNous allons transformer le script utilisé pour cette analyse en un fichier `Rmd` qui sera compilé pour générer un rapport. Téléchargez le script [ici](https://raw.githubusercontent.com/codons-blog/ateliers_codons/main/scripts/intro_rmd.R) et sauvegardez-le dans le dossier `scripts` de votre projet. Ouvrez-le afin de l'avoir à portée de main (il s'ouvrira dans un nouvel onglet à côté de votre fichier `Rmd`)\n\n## Introduction\n\nCommençons par rédiger une courte introduction avec les éléments suivants : \n\n- nom du fichier  \n\n- lien vers l'étude  \n\n- image avec référence et lien\n\nCopiez le texte ci-dessous et collez-le dans votre fichier `Rmd` : \n\n````\nLe fichier `pingouins.csv` contient des mesures pour [trois espèces de pingouins vivant en Antarctique (archipel Palmer)](https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0090081#s2).\n\n![[Dessin de @allison_horst](https://allisonhorst.com/)](../figs/pingouins.png){width=\"50%\"}\n````\n<br>\n\n## Importer les données\n\nPour utiliser les données dans notre fichier `Rmd` nous devons les importer.\n\nDans le cadre de ce tutoriel nous choisissons de ne pas faire apparaître le code utilisé pour importer les données. Nous ajoutons donc les paramètres nécessaires dans le bloc de code. Comme dans un script, nous commentons les blocs de code.\n\n````\n```{r, importer donnees, echo=FALSE}\n# Importer les donnees sans afficher le code\npingouins <- read.csv(\"../data/pingouins_propre.csv\")\n```\n````\n\n## Décrire les données\n\nNous pouvons afficher les dimensions du tableau à l'aide de code dynamique : \n\n::: {.cell}\n\n```{.r .cell-code}\nLe jeu de données contient **`r nrow(pingouins)` observations** et **`r ncol(pingouins)` variables**.\n```\n:::\n\n\nNous pouvons extraire les noms des espèces et des îles : \n\n\n::: {.cell}\n\n```{.r .cell-code}\nLes mesures concernent **trois espèces** de pingouins : \n\n- *`r sort(unique(pingouins$espece))[1]`*  \n\n- *`r sort(unique(pingouins$espece))[2]`*  \n\n- *`r sort(unique(pingouins$espece))[3]`*\n\nCes pingouins vivent sur **trois îles** : \n\n- `r sort(unique(pingouins$ile))[1]` \n\n- `r sort(unique(pingouins$ile))[2]`  \n\n- `r sort(unique(pingouins$ile))[3]`\n```\n:::\n\n\nComment les espèces sont-elles réparties sur les îles ?\n\n````\nLes individus se répartissent de la façon suivante : \n\n```{r, repartition individus, echo=FALSE, comment=\"\"}\n# Tableau de la répartition des individus\ntable(pingouins$espece, pingouins$ile)\n```\n````\n\n::: {.callout-note icon=\"true\"}\n## Afficher ou non les # en sortie\n\nLe paramètre `comment = \"\"` utilisé dans le bloc de code ci-dessus permet de ne pas afficher de `#` dans la sortie.\n:::\n\nQuelles sont les variables du tableau ?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nLes variables sont les suivantes : \n  \n| variable                | type                       | exemple             |\n| :---------------------: | :------------------------: | :-----------------: |\n| `r names(pingouins)[1]` | `r typeof(pingouins[, 1])` | `r pingouins[1, 1]` |\n| `r names(pingouins)[2]` | `r typeof(pingouins[, 2])` | `r pingouins[1, 2]` |\n| `r names(pingouins)[3]` | `r typeof(pingouins[, 3])` | `r pingouins[1, 3]` |\n| `r names(pingouins)[4]` | `r typeof(pingouins[, 4])` | `r pingouins[1, 4]` |\n| `r names(pingouins)[5]` | `r typeof(pingouins[, 5])` | `r pingouins[1, 5]` |\n| `r names(pingouins)[6]` | `r typeof(pingouins[, 6])` | `r pingouins[1, 6]` | \n```\n:::\n\n\n\nPour clore cette description du jeu de données, affichons les premières lignes du tableau. La fonction `kable()` du package `knitr` permet d'afficher des tableaux : \n\n````\nLes données se présentent comme ci-dessous : \n\n```{r, apercu tableau, echo=FALSE}\n# Afficher les 3 premieres lignes\nknitr::kable(head(pingouins, 3))\n```\n````\n\n## Représenter les données\n\nRMarkdown permet d'exécuter le code utilisé pour générer un graphique et d'afficher celui-ci directement dans le document :\n\n![](img/rmd_52.png)\n\nVous pouvez afficher deux graphiques côte à côté, à l'aide d'options à placer dans les accolades `{r ...}` :\n\n-   `out.width` pour préciser les largeurs des graphiques (en %)\n\n-   `fig.show = \"hold\"` pour indiquer à R d'attendre d'avoir exécuté le code pour les deux graphiques avant de les afficher\n\n![](img/rmd_53.png)\n\n## Ajouter un sommaire\n\nVous pouvez ajouter un sommaire à votre document, en ajoutant des options dans l'en-tête :\n\n-   `toc: true` : activer le sommaire (\\*table of contents)\n\n-   `toc_depth` : définir le nombre de niveaux à afficher dans le sommaire\n\n![](img/rmd_54.png)\n\n## Compiler le fichier Rmd au format `pdf`\n\nPour exporter votre document au format pdf, vous pouvez modifier l'en-tête :\n\n![](img/rmd_55.png)\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}