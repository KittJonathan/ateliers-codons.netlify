---
title: "Introduction à GitLab"
subtitle: "Connecter RStudio à GitLab et assurer le suivi de version"
author:
  - Jonathan Kitt
date: "2022-11-21"
draft: true
categories: [R, RStudio, GitLab]
format: 
  html: 
    toc: true
    toc-depth: 2
    toc-title: "Sommaire"
---

# Introduction

## Git, GitLab et suivi de version

## Pré-requis

### Installer git

Sur le site de [git](https://git-scm.com/downloads), téléchargez la dernière version pour votre système d'exploitation.

![](img/git_01.png){width="100%"}

![](img/git_02.png){width="100%"}

Double-cliquez sur l'exécutable `Git-xxxx.exe` :

![](img/git_03.png){width="100%"}

Laissez les paramètres par défaut proposés par l'assistant d'installation. Dans le menu *Choosing the default editor used by Git*, vous pouvez laisser l'éditeur de texte proposé par défaut (Vim) ou choisir l'éditeur de texte que vous avez l'habitude d'utiliser.

![](img/git_04.png){width="50%"}

Dans les menus suivants, laissez les paramètres suivants jusqu'à ce que l'installation de `git` soit complétée.

### Paramétrer RStudio

Ouvrez une session dans RStudio, puis cliquez sur *Tools* \> *Global Options* \> *Git/SVN*.

![](img/git_06.png){width="50%"}

1. Assurez-vous que la case *Enable version control interface for RStudio projects* est cochée.  

2. Assurez-vous que le chemin vers l'exécutable `git` est bien renseigné. Le cas échéant, cliquez sur *Browse* et indiquez le chemin vers son emplacement.

3. Si aucune clé SSH n'est indiquée, cliquez sur *Create RSA Key...*.  

4. Validez en cliquant sur *Apply*.

<br>

Cliquez sur *View public key* et copiez la clé qui s'affiche.

### Paramétrer GitLab

Ouvrez [ce lien](https://forgemia.inra.fr) dans votre navigateur internet et cliquez sur *Connexion SSO*.

![](img/git_07.png){width="50%"}

Dans le menu déroulant, choisissez *INRAE* et cliquez sur *Sélectionner*. Dans le menu suivant, renseignez les champs à l'aide de votre identifiant LDAP puis cliquez sur *Se connecter*.

::: {layout-ncol=2}

![](img/git_08.png){width="50%"}

![](img/git_09.png){width="50%"}

:::

<br>

Cliquez sur l'icône dans le coin supérieur droit puis sur *Preferences*.

![](img/git_10.png){width="50%"}

Dans la barre de menu à gauche, cliquez sur la première icône en forme de clé. Collez dans le champ *Key* la clé SSH copiée dans RStudio. Le champ *Title* devrait se remplir automatiquement. Si ce n'est pas le cas, renseignez ce champ. Vous pouvez choisir une date d'expiration de votre clé dans *Expiration date*. Pour terminer, cliquez sur *Add key*. Assurez-vous que votre clé apparaisse bien en base de la page sous *Your SSH keys*.

![](img/git_11.png)

# De GitLab vers RStudio

## Dans GitLab

Dans la barre de menu supérieure, cliquez sur l'icône *plus* et sélectionnez *New project/repository*.
Dans le menu suivant, choisissez *Create blank project*.

::: {layout-ncol=2}

![](img/git_12.png){width="50%"}

![](img/git_13.png){width="50%"}

:::

<br>

Dans le menu *Create blank project*, remplissez les différents champs : 

- *Project name* : nom du projet (avec les mêmes conventions d'écriture que si vous étiez en train de [créer un projet dans RStudio](https://ateliers-codons.netlify.app/posts/02-premiers-pas-avec-r/#cr%C3%A9er-un-projet)).  

- *Project URL* : en fonction des groupes dont vous faites partie, vous pourrez choisir l'emplacement du projet. Pour l'instant, choisissez votre espace utilisateur.  

- *Project slug* : identique au nom du projet.  

- *Visibility Level* : qui a accès au projet. Pour notre exemple, choisissez *Public*.  

- *Project Configuration* : cochez la case *Initialize repository with a README*. 

Cliquez sur *Create project*. Le projet s'ouvre et vous pouvez voir qu'il contient un ficher `README.md`. Ce fichier s'affiche sur la page d'accueil de votre projet et contient par défaut des informations sur l'utilisation de GitLab.

![](img/git_15.png)

<br>

Nous allons maintenant "rapatrier" ce projet sur notre ordinateur. Pour cela, cliquez sur l'onglet *Clone* et choisissez *Clone with SSH*. Cliquez sur *Copy URL*.

![](img/git_16.png)

## Dans RStudio

Dans la barre de menu supérieure, cliquez sur *File* > *New project*.  
Dans la fenêtre *Create Project*, choisissez *Version Control*.

::: {layout-ncol=2}

![](img/git_17.png)

![](img/git_18.png)

:::

Dans la fenêtre *Create Project from Version Control*, choisissez *Git*.  

Dans la fenêtre *Clone Git Repository*, remplissez les champs : 
- *Repository URL* : collez le lien SSH copié dans GitLab  
- *Project directory name* : se remplit automatiquement  
- *Create project as subdirectory of* : emplacement où sera créé le projet

Cochez la case *Open in New Session* dans le coin inféreur gauche de la fenêtre et cliquez sur *Create Project*.

::: {layout-ncol=2}

![](img/git_19.png)

![](img/git_20.png)

:::

Une nouvelle fenêtre RStudio s'ouvre. Vous remarquerez la présence d'un onglet *Git* dans votre espace de travail. 

## Workflow

Dans votre espace de travail, sous l'onglet *git*, deux fichiers sont présents : 

- `.gitignore`  
- `test_gitlab_rstudio.Rproj`

Ces fichiers ont été ajoutés dans votre répertoire de travail lors de la création du projet dans RStudio, mais ils ne sont pas présents dans votre répertoire sur GitLab. L'icône `?` indique qu'il s'agit de nouveaux fichiers.

Nous allons ajouter ces fichiers en cochant les cases à gauche des icônes de statut. Ces icônes deviennent un `A` vert : ces deux fichiers ont été ajoutés.

Cliquez sur *Commit* et ajoutez un commentaire dans la fenêtre qui s'ouvre.

::: {layout-ncol=2}

![](img/git_24.png)

![](img/git_25.png)

:::

Cliquez ensuite sur *Commit* : un résumé de votre soumission s'affiche. Fermez cette fenêtre en cliquant sur *Close*.

![](img/git_26.png)

Dans la fenêtre *RStudio: Review Changes*, vous pouvez lire *Your branch is ahead of 'origin/main' by 1 commit'*. Cela indique que votre branche locale est en avance d'une étape sur la branche distance sur GitLab. Il vous reste à *pousser* votre soumission vers la brache distance en cliquant sur *Push*. 

![](img/git_27.png)
Rafraîchissez votre page GitLab : les deux fichiers apparaissent maintenant dans l'arborescence.

![](img/git_28.png)


::: {.callout-tip icon="true"}
## Le statut des fichiers

L'icône à gauche du nom d'un fichier dans l'onglet *git* de votre espace de travail indique le statut de ce fichier : 

|                     |                 |
| ------------------- | --------------- |
| ![](img/git_22.png) | nouveau fichier |
| ![](img/git_23.png) | fichier ajouté  |

:::

